{% extends "layout.html" %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-center">éŠæˆ¯ç‹ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ</h2>

  <!-- ğŸ” æ¤œç´¢ãƒ»ã‚½ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ  -->
  <form method="GET" action="/" class="row g-3 align-items-end mb-4">

    <!-- è¡¨ç¤ºä»¶æ•° -->
    <div class="col-6 col-md-2">
      <label for="per_page" class="form-label">è¡¨ç¤ºä»¶æ•°:</label>
      <select name="per_page" id="per_page" class="form-select">
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
        <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
      </select>
    </div>

    <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
    <div class="col-12 col-md-4">
      <label for="keyword" class="form-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢:</label>
      <div class="input-group">
        <input type="text" name="keyword" id="keyword" class="form-control" placeholder="å•†å“åã®ä¸€éƒ¨" value="{{ keyword }}">
        <button type="submit" class="btn btn-outline-primary">æ¤œç´¢</button>
      </div>
    </div>

    <!-- åœ¨åº«0ã‚’è¡¨ç¤º -->
    <div class="col-6 col-md-2 d-flex align-items-center mt-4">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="show_zero" id="show_zero" {% if show_zero %}checked{% endif %}>
        <label class="form-check-label" for="show_zero">åœ¨åº«æ•°0ã‚’è¡¨ç¤º</label>
      </div>
    </div>

    <!-- ã‚½ãƒ¼ãƒˆ -->
    <div class="col-12 col-md-4">
      <label class="form-label">ã‚½ãƒ¼ãƒˆ:</label>
      <div class="input-group">
        <select name="sort_key" class="form-select">
          <option value="name" {% if sort_key == 'name' %}selected{% endif %}>åå‰</option>
          <option value="card_id" {% if sort_key == 'card_id' %}selected{% endif %}>ã‚«ãƒ¼ãƒ‰ID</option>
          <option value="rare" {% if sort_key == 'rare' %}selected{% endif %}>ãƒ¬ã‚¢</option>
          <option value="stock" {% if sort_key == 'stock' %}selected{% endif %}>åœ¨åº«æ•°</option>
        </select>
        <select name="sort_order" class="form-select">
          <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>æ˜‡é †</option>
          <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>é™é †</option>
        </select>
      </div>
    </div>
  </form>

  <!-- æ¤œç´¢çµæœãŒ0ä»¶ã ã£ãŸå ´åˆã®æ¡ˆå†… -->
  {% if items|length == 0 and keyword %}
  <div class="alert alert-warning text-center">
    ã€Œ{{ keyword }}ã€ã«è©²å½“ã™ã‚‹å•†å“ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>
    <a href="{{ url_for('add_item_page') }}?name={{ keyword }}" class="btn btn-outline-success mt-2">ã“ã®åå‰ã§æ–°ã—ãå•†å“ã‚’ç™»éŒ²</a>
  </div>
  {% endif %}

  <!-- é¡ä¼¼å•†å“ã‚ã‚Š + card_idä¸ä¸€è‡´ â†’ æ–°è¦è¿½åŠ æ¡ˆå†… -->
  {% if show_add_hint and keyword %}
  <div class="alert alert-info text-center">
    æ¤œç´¢çµæœã«ã€Œ{{ keyword }}ã€ã¨ã„ã†ã‚«ãƒ¼ãƒ‰IDã¯å­˜åœ¨ã—ãªã„ã‚ˆã†ã§ã™ã€‚<br>
    <a href="{{ url_for('add_item_page') }}?name={{ keyword }}" class="btn btn-outline-success mt-2">ã“ã®å‹ç•ªã§æ–°ã—ãå•†å“ã‚’ç™»éŒ²ã™ã‚‹</a>
  </div>
  {% endif %}

  <!-- ğŸ“¦ ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ -->
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>åå‰</th>
        <th>ã‚«ãƒ¼ãƒ‰ID</th>
        <th>ãƒ¬ã‚¢</th>
        <th>åœ¨åº«æ•°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.name }}</td>
        <td>{{ item.card_id }}</td>
        <td>{{ item.rare }}</td>
        <td>{{ item.stock }}</td>
        <td>
          <a href="{{ url_for('edit_item', card_id=item.card_id) }}" class="btn btn-sm btn-primary">ç·¨é›†</a>
          <a href="{{ url_for('confirm_delete', card_id=item.card_id) }}" class="btn btn-sm btn-danger">å‰Šé™¤</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- ğŸ”½ ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåœ§ç¸®è¡¨ç¤ºï¼‰ -->
  <nav>
    <ul class="pagination justify-content-center">
      {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page - 1 }}&per_page={{ per_page }}&keyword={{ keyword }}&sort_key={{ sort_key }}&sort_order={{ sort_order }}{% if show_zero %}&show_zero=on{% endif %}">å‰ã¸</a>
      </li>
      {% endif %}

      {% set shown = [] %}
      {% for p in range(1, total_pages + 1) %}
        {% if p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
          {% if shown and p - shown[-1] > 1 %}
            <li class="page-item disabled"><span class="page-link">â€¦</span></li>
          {% endif %}
          <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="?page={{ p }}&per_page={{ per_page }}&keyword={{ keyword }}&sort_key={{ sort_key }}&sort_order={{ sort_order }}{% if show_zero %}&show_zero=on{% endif %}">{{ p }}</a>
          </li>
          {% set _ = shown.append(p) %}
        {% endif %}
      {% endfor %}

      {% if page < total_pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page + 1 }}&per_page={{ per_page }}&keyword={{ keyword }}&sort_key={{ sort_key }}&sort_order={{ sort_order }}{% if show_zero %}&show_zero=on{% endif %}">æ¬¡ã¸</a>
      </li>
      {% endif %}
    </ul>
  </nav>

  <!-- æ–°è¦å•†å“ç™»éŒ²ãƒœã‚¿ãƒ³ï¼ˆå…¨ä½“ã§ã‚‚è¡¨ç¤ºï¼‰ -->
  <div class="text-center mt-4">
    <a href="{{ url_for('add_item_page') }}" class="btn btn-outline-success">ï¼‹ æ–°è¦å•†å“ã‚’ç™»éŒ²</a>
  </div>
</div>
{% endblock %}
