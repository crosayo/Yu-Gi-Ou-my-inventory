{% extends "layout.html" %}

{% block content %}
<h2 class="text-center mb-4" style="font-family: 'Roboto', sans-serif; color: #0275d8; font-weight: bold; font-size: 28px;">遊戯王カードリスト</h2>

<!-- フィルターフォーム -->
<form method="get" class="filter-form mb-4">
    <div class="row justify-content-center">
        <div class="col-sm-3">
            <label>表示件数:</label>
            <select name="per_page" class="form-select" onchange="this.form.submit()" style="font-size: 16px; font-weight: bold;">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
            </select>
        </div>
        <div class="col-sm-3 d-flex align-items-end">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="show_zero" id="showZero" onchange="this.form.submit()" {% if show_zero %}checked{% endif %}>
                <label class="form-check-label" for="showZero" style="font-size: 16px; font-weight: bold;">
                    在庫数0を表示
                </label>
            </div>
        </div>
        <div class="col-sm-3">
            <label>キーワード検索:</label>
            <input type="text" name="keyword" value="{{ keyword }}" class="form-control" placeholder="例: 青眼の白龍" style="font-size: 16px; font-weight: bold;">
        </div>
        <div class="col-sm-1 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100" style="font-size: 16px; font-weight: bold;">検索</button>
        </div>
    </div>

    <div class="row justify-content-center align-items-end mt-4">
        <div class="col-sm-3">
            <label>ソート項目:</label>
            <select name="sort_by" class="form-select" style="font-size: 16px; font-weight: bold;">
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>名前</option>
                <option value="card_id" {% if sort_by == 'card_id' %}selected{% endif %}>カードID</option>
                <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>在庫数</option>
            </select>
        </div>
        <div class="col-sm-3">
            <label>並び順:</label>
            <select name="sort_order" class="form-select" style="font-size: 16px; font-weight: bold;">
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>昇順</option>
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>降順</option>
            </select>
        </div>
        <div class="col-sm-2 d-flex align-items-end">
            <button type="submit" class="btn btn-secondary w-100" style="font-size: 16px; font-weight: bold;">ソート</button>
        </div>
    </div>
</form>

<!-- 商品テーブル -->
<table class="table table-bordered table-striped" style="background-color: #f8f9fa; border-radius: 8px;">
    <thead class="thead-light">
        <tr>
            <th class="text-center" style="font-size: 16px;">名前</th>
            <th class="text-center" style="font-size: 16px;">カードID</th>
            <th class="text-center" style="font-size: 16px;">レア</th>
            <th class="text-center" style="font-size: 16px;">在庫数</th>
            {% if logged_in %}<th class="text-center" style="font-size: 16px;">操作</th>{% endif %}
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td class="text-center" style="font-weight: bold;">{{ item.name or '（名前なし）' }}</td>
            <td class="text-center">{{ item.card_id or '（IDなし）' }}</td>
            <td class="text-center">{{ item.rare or '（レア不明）' }}</td>
            <td class="text-center">{{ item.stock }}</td>
            {% if logged_in %}
            <td class="text-center"><a href="{{ url_for('edit') }}" class="btn btn-info btn-sm">編集</a></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ページネーション -->
{% if total_pages > 1 %}
<div class="pagination justify-content-center">
    <a href="?per_page={{ per_page }}&page={{ page - 1 if page > 1 else 1 }}&show_zero={{ 'on' if show_zero else '' }}&keyword={{ keyword }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}" class="btn btn-outline-secondary {% if page == 1 %}disabled{% endif %}">前</a>

    {% for p in range(page_range_start, page_range_end) %}
        {% if p == page %}
            <strong class="btn btn-primary btn-sm active">{{ p }}</strong>
        {% else %}
            <a href="?per_page={{ per_page }}&page={{ p }}&show_zero={{ 'on' if show_zero else '' }}&keyword={{ keyword }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}" class="btn btn-outline-primary btn-sm">{{ p }}</a>
        {% endif %}
    {% endfor %}

    <a href="?per_page={{ per_page }}&page={{ page + 1 if page < total_pages else total_pages }}&show_zero={{ 'on' if show_zero else '' }}&keyword={{ keyword }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}" class="btn btn-outline-secondary {% if page == total_pages %}disabled{% endif %}">次</a>
</div>
{% endif %}

{% endblock %}
